<html>
  <head></head>
  <body>
    <div id="chart_div"></div>
    <div id="chart_div2"></div>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
    <script
      src="https://vk.com/js/api/openapi.js?168"
      type="text/javascript"
    ></script>
    <script type="text/javascript">
      const ranges = [];
      let allItems = [];

      [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24].forEach((item) => {
        ranges.push({
          min: item - 2,
          max: item,
          likes: 0,
          reposts: 0,
          comments: 0,
          views: 0,
        });
      });

      VK.init({
        apiId: 7769410,
      });

      VK.Api.call(
        "wall.get",
        { owner_id: "-24936435", count: 100, v: "5.130" },
        function (r) {
          allItems = r.response.items;
        }
      );

      const myInterval = setInterval(() => {
        if (allItems.length > 0) {
          clearInterval(myInterval);
          VK.Api.call(
            "wall.get",
            { owner_id: "-24936435", count: 100, v: "5.130", offset: 100 },
            function (r) {
              allItems = allItems.concat(r.response.items);

              r.response.items.forEach((item) => {
                ranges.forEach((item0) => {
                  if (
                    new Date(item.date * 1000).getHours() >= item0.min &&
                    new Date(item.date * 1000).getHours() < item0.max
                  ) {
                    item0.likes += item.likes.count;
                    item0.reposts += item.reposts.count;
                    item0.comments += item.comments.count;
                    item0.views += item.views.count;
                  }
                });
              });

              google.charts.load("current", { packages: ["corechart", "bar"] });
              google.charts.setOnLoadCallback(drawMultSeries);
              google.charts.setOnLoadCallback(drawMultSeries2);

              function drawMultSeries() {
                var data = new google.visualization.DataTable();
                data.addColumn("timeofday", "Часы");
                data.addColumn("number", "Просмотры");

                data.addRows([
                  [
                    { v: [1, 0, 0], f: "2 am" },
                    ranges[0].views,
                  ],
                  [
                    { v: [3, 0, 0], f: "4 am" },
                    ranges[1].views,
                  ],
                  [
                    { v: [5, 0, 0], f: "6 am" },
                    ranges[2].views,
                  ],
                  [
                    { v: [7, 0, 0], f: "8 am" },
                    ranges[3].views,
                  ],
                  [
                    { v: [9, 0, 0], f: "10 am" },
                    ranges[4].views,
                  ],
                  [
                    { v: [11, 0, 0], f: "0 pm" },
                    ranges[5].views,
                  ],
                  [
                    { v: [13, 0, 0], f: "2 pm" },
                    ranges[6].views,
                  ],
                  [
                    { v: [15, 0, 0], f: "4 pm" },
                    ranges[7].views,
                  ],
                  [
                    { v: [17, 0, 0], f: "6 pm" },
                    ranges[8].views,
                  ],
                  [
                    { v: [19, 0, 0], f: "8 pm" },
                    ranges[9].views,
                  ],
                  [
                    { v: [21, 0, 0], f: "10 pm" },
                    ranges[10].views,
                  ],
                  [
                    { v: [23, 0, 0], f: "12 pm" },
                    ranges[11].views,
                  ],
                ]);

                var options = {
                  title: "Просмотры",
                  hAxis: {
                    title: "Часы",
                    viewWindow: {
                      min: [0, 0, 0],
                      max: [24, 0, 0],
                    },
                  },
                  isStacked: true,
                  vAxis: {
                    title: "Шкала",
                  },
                };

                var chart = new google.visualization.ColumnChart(
                  document.getElementById("chart_div")
                );

                chart.draw(data, options);
              }

              function drawMultSeries2() {
                var data = new google.visualization.DataTable();
                data.addColumn("timeofday", "Часы");
                data.addColumn("number", "Лайки");
                data.addColumn("number", "Репосты");
                data.addColumn("number", "Комменты");

                data.addRows([
                  [
                    { v: [1, 0, 0], f: "2 am" },
                    ranges[0].likes,
                    ranges[0].reposts,
                    ranges[0].comments,
                  ],
                  [
                    { v: [3, 0, 0], f: "4 am" },
                    ranges[1].likes,
                    ranges[1].reposts,
                    ranges[1].comments,
                  ],
                  [
                    { v: [5, 0, 0], f: "6 am" },
                    ranges[2].likes,
                    ranges[2].reposts,
                    ranges[2].comments,
                  ],
                  [
                    { v: [7, 0, 0], f: "8 am" },
                    ranges[3].likes,
                    ranges[3].reposts,
                    ranges[3].comments,
                  ],
                  [
                    { v: [9, 0, 0], f: "10 am" },
                    ranges[4].likes,
                    ranges[4].reposts,
                    ranges[4].comments,
                  ],
                  [
                    { v: [11, 0, 0], f: "0 pm" },
                    ranges[5].likes,
                    ranges[5].reposts,
                    ranges[5].comments,
                  ],
                  [
                    { v: [13, 0, 0], f: "2 pm" },
                    ranges[6].likes,
                    ranges[6].reposts,
                    ranges[6].comments,
                  ],
                  [
                    { v: [15, 0, 0], f: "4 pm" },
                    ranges[7].likes,
                    ranges[7].reposts,
                    ranges[7].comments,
                  ],
                  [
                    { v: [17, 0, 0], f: "6 pm" },
                    ranges[8].likes,
                    ranges[8].reposts,
                    ranges[8].comments,
                  ],
                  [
                    { v: [19, 0, 0], f: "8 pm" },
                    ranges[9].likes,
                    ranges[9].reposts,
                    ranges[9].comments,
                  ],
                  [
                    { v: [21, 0, 0], f: "10 pm" },
                    ranges[10].likes,
                    ranges[10].reposts,
                    ranges[10].comments,
                  ],
                  [
                    { v: [23, 0, 0], f: "12 pm" },
                    ranges[11].likes,
                    ranges[11].reposts,
                    ranges[11].comments,
                  ],
                ]);

                var options = {
                  title: "Реакции",
                  hAxis: {
                    title: "Часы",
                    viewWindow: {
                      min: [0, 0, 0],
                      max: [24, 0, 0],
                    },
                  },
                  isStacked: true,
                  vAxis: {
                    title: "Шкала",
                  },
                };

                var chart = new google.visualization.ColumnChart(
                  document.getElementById("chart_div2")
                );

                chart.draw(data, options);
              }
            }
          );
        }
      }, 1000);
    </script>
  </body>
</html>
